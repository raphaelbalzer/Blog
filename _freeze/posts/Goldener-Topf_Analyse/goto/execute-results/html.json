{
  "hash": "ea2d440a4ec2fd29880b413537507069",
  "result": {
    "markdown": "---\ntitle: \"Miniprojekt DS\"\nauthor: \"Raphael Balzer\"\ndate: \"2023-10-25\"\nimage: \"topf.jpeg\"\ncategories: \n  - Text-Analyse\n---\n\n\n# Textanalyse von E.T.A-Hoffmanns \"Der goldene Topf\"\n\n\n::: {.cell class='floating-code'}\n\n```{.r .cell-code}\nlibrary(tokenizers)\nlibrary(tidyverse)\nlibrary(tidytext)\nlibrary(ggthemes)\nlibrary(topicmodels)\nlibrary(tm)\n```\n:::\n\n\n## Datenimport\n\nTextanalyse von E.T.A-Hoffmanns \"Der goldene Topf\".\n\n\n::: {.cell class='floating-code'}\n\n```{.r .cell-code}\ntopf <- read.delim2(\"https://www.gutenberg.org/cache/epub/17362/pg17362.txt\")\ntopf <- as_tibble(topf)\ntopf <- topf[-c(1:24, 2678:2979), ]\ntopf\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2,653 × 1\n   The.Project.Gutenberg.eBook.of.Der.Goldene.Topf                  \n   <chr>                                                            \n 1 DER GOLDENE TOPF                                                 \n 2 von                                                              \n 3 E.T.A. HOFFMANN:                                                 \n 4 Mit 11 Federzeichnungen von Edmund Schaefer                      \n 5 [Illustration: Titelbild. Die Frauenkirche in Dresden]           \n 6 Erstes bis fünftes Tausend                                       \n 7 Verlag von Gustav Kiepenheuer Weimar 1913                        \n 8 ERSTE VIGILIE.                                                   \n 9 Die Unglücksfälle des Studenten Anselmus. Des Konrektors Paulmann\n10 Sanitätsknaster und die goldgrünen Schlangen.                    \n# ℹ 2,643 more rows\n```\n:::\n:::\n\n\n### Tokenisierung\n\n\n::: {.cell class='floating-code'}\n\n```{.r .cell-code}\ntopf_token <- topf %>% \n  unnest_tokens(output = token, input = The.Project.Gutenberg.eBook.of.Der.Goldene.Topf) %>% \n  filter(str_detect(token, \"[a-z]\"))\ntopf_token\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 29,219 × 1\n   token           \n   <chr>           \n 1 der             \n 2 goldene         \n 3 topf            \n 4 von             \n 5 e.t.a           \n 6 hoffmann        \n 7 mit             \n 8 federzeichnungen\n 9 von             \n10 edmund          \n# ℹ 29,209 more rows\n```\n:::\n:::\n\n\n### Entfernen der Stop-Words\n\n\n::: {.cell class='floating-code'}\n\n```{.r .cell-code}\ndata(stopwords_de, package = \"lsa\")\n\nstopwords_de <- tibble(word = stopwords_de)\n\nstopwords_de <- stopwords_de %>% \n  rename(token = word)  \n\ntopf_token <- topf_token %>% \n  anti_join(stopwords_de)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nJoining with `by = join_by(token)`\n```\n:::\n\n```{.r .cell-code}\ntopf_token %>% \n  count(token, sort = TRUE) %>% \n  print()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 5,508 × 2\n   token           n\n   <chr>       <int>\n 1 er            446\n 2 anselmus      291\n 3 archivarius   160\n 4 denn          151\n 5 du            144\n 6 nun           137\n 7 ihn           118\n 8 veronika      105\n 9 student        97\n10 wohl           94\n# ℹ 5,498 more rows\n```\n:::\n:::\n\n\n## Sentimentanalyse\n\n\n::: {.cell class='floating-code'}\n\n```{.r .cell-code}\ndata(sentiws, package = \"pradadata\")\ntopf_senti <- topf_token %>% \n  inner_join(sentiws, by = c(\"token\" = \"word\")) %>% \n  select(-inflections)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning in inner_join(., sentiws, by = c(token = \"word\")): Detected an unexpected many-to-many relationship between `x` and `y`.\nℹ Row 2698 of `x` matches multiple rows in `y`.\nℹ Row 3187 of `y` matches multiple rows in `x`.\nℹ If a many-to-many relationship is expected, set `relationship =\n  \"many-to-many\"` to silence this warning.\n```\n:::\n\n```{.r .cell-code}\ntopf_senti\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 600 × 3\n   token     neg_pos   value\n   <chr>     <chr>     <dbl>\n 1 glücklich pos      0.115 \n 2 besonders pos      0.539 \n 3 schnell   pos      0.117 \n 4 lachen    pos      0.0135\n 5 entziehen neg     -0.0048\n 6 weise     pos      0.224 \n 7 festlich  pos      0.202 \n 8 kurz      neg     -0.0048\n 9 langsam   neg     -0.0167\n10 einsam    neg     -0.163 \n# ℹ 590 more rows\n```\n:::\n:::\n\n::: {.cell class='floating-code'}\n\n```{.r .cell-code}\ntopf_senti %>%\n  count(token, neg_pos, sort = TRUE) %>%\n  ungroup() %>%\n  group_by(neg_pos) %>%\n  slice_max(n, n = 10)%>%\n  ungroup() %>%\n  mutate(token = reorder(token, n)) %>%\n  ggplot(aes(n, token, fill = neg_pos)) +\n  geom_col(show.legend = FALSE) +\n  facet_wrap(~neg_pos, scales = \"free_y\") +\n  labs(x = \"Häufigkeit\",\n       y = \"Wort\") +\n  theme_minimal() +\n  scale_fill_tableau(palette = \"Nuriel Stone\")\n```\n\n::: {.cell-output-display}\n![](goto_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n::: {.cell class='floating-code'}\n\n```{.r .cell-code}\ntopf_senti %>% \n  group_by(neg_pos) %>% \n  summarise(polarity_sum = sum(value),\n            polarity_count = n()) %>% \n  mutate(polarity_prop = (polarity_count / sum(polarity_count)) %>% \n           round(2))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2 × 4\n  neg_pos polarity_sum polarity_count polarity_prop\n  <chr>          <dbl>          <int>         <dbl>\n1 neg            -29.5            184          0.31\n2 pos             72.3            416          0.69\n```\n:::\n:::\n\n::: {.cell class='floating-code'}\n\n```{.r .cell-code}\ntopf_senti %>% \n  distinct(token, .keep_all = TRUE) %>% \n  mutate(value_abs = abs(value)) %>%\n  group_by(neg_pos) %>%\n  top_n(10, value_abs) %>%\n  mutate(token = reorder(token, value_abs)) %>%\n  ggplot(aes(value_abs, token, fill = neg_pos)) +\n  geom_col(show.legend = FALSE) +\n  facet_wrap(~neg_pos, scales = \"free_y\") +\n  labs(x = \"Effektstärke\",\n       y = \"Wort\") +\n  theme_minimal() +\n  scale_fill_tableau(palette = \"Nuriel Stone\")\n```\n\n::: {.cell-output-display}\n![](goto_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n## n-gram - Analyse\n\nHäufigkeiten der Bigramme\n\n\n::: {.cell class='floating-code'}\n\n```{.r .cell-code}\ntopf_bigram <- \n  topf %>%\n  unnest_tokens(bigram, The.Project.Gutenberg.eBook.of.Der.Goldene.Topf, token = \"ngrams\", n = 2) %>%\n  filter(!is.na(bigram))\n\n\ntopf_bigram %>% \ncount(bigram, sort = TRUE) %>% \n  print()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 19,046 × 2\n   bigram                    n\n   <chr>                 <int>\n 1 in der                   89\n 2 der student              85\n 3 student anselmus         77\n 4 archivarius lindhorst    72\n 5 der archivarius          67\n 6 in den                   49\n 7 in die                   49\n 8 der konrektor            46\n 9 in dem                   46\n10 konrektor paulmann       46\n# ℹ 19,036 more rows\n```\n:::\n:::\n\n\n### Ohne Stopwords\n\n\n::: {.cell class='floating-code'}\n\n```{.r .cell-code}\ntopf_bigra_sep <- topf_bigram %>%\n  separate(bigram, c(\"word1\", \"word2\"), sep = \" \")%>%\n  filter(!word1 %in% stop_words$word) %>%\n  filter(!word2 %in% stop_words$word)\n\ntopf_bigra_sep %>%\n  unite(bigram, word1, word2, sep = \" \") %>%\n  count(bigram, sort = TRUE) %>%\n  slice_max(n, n = 10)%>%\n  mutate(bigram = reorder(bigram, n)) %>%\n  ggplot(aes(n, bigram)) +\n  geom_col(fill = \"#8175aa\") +\n  labs(x = \"Häufigkeit\",\n       y = \"Bigram\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](goto_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n### Beitrag von Verneinungen zu Sentimenten\n\n\n::: {.cell class='floating-code'}\n\n```{.r .cell-code}\nVerneinungen <- c(\"nicht\", \"nie\", \"niemals\", \"keine\", \"kein\")\n\ntopf_bigra_sep %>%\n  filter(word1 %in% Verneinungen) %>%\n  inner_join(sentiws, by = c(word2 = \"word\")) %>%\n  count(word1, word2, value, sort = TRUE) %>% \n  mutate(Beitrag = n * value) %>%\n  arrange(desc(abs(Beitrag))) %>%\n  head(20) %>%\n  mutate(word2 = reorder(word2, Beitrag)) %>%\n  ggplot(aes(n * value, word2, fill = n * value > 0)) +\n  geom_col(show.legend = FALSE) +\n  labs(x = \"Sentiment-Wert * Häufigkeit\",\n       y = \"Verneinungen\") +\n  theme_minimal()+\n  scale_fill_tableau(\"Nuriel Stone\")\n```\n\n::: {.cell-output-display}\n![](goto_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n## Themenanalyse\n\n\n::: {.cell class='floating-code'}\n\n```{.r .cell-code}\ntopf_dtm <- DocumentTermMatrix(topf_token)\ntopf_lda <- LDA(topf_dtm, k = 4, control = list(seed = 42))\n```\n:::\n\n::: {.cell class='floating-code'}\n\n```{.r .cell-code}\ntopf_themen <- tidy(topf_lda, matrix = \"beta\")\n\ntopf_themen <- topf_themen %>%\n  group_by(topic) %>%\n  slice_max(beta, n = 10) %>% \n  ungroup() %>%\n  arrange(topic, -beta)\n\ntopf_themen %>%\n  mutate(term = reorder_within(term, beta, topic)) %>%\n  ggplot(aes(beta, term, fill = factor(topic))) +\n  geom_col(show.legend = FALSE) +\n  facet_wrap(~ topic, scales = \"free\") +\n  scale_y_reordered() +\n  theme_minimal() +\n  scale_fill_tableau(\"Nuriel Stone\")\n```\n\n::: {.cell-output-display}\n![](goto_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "goto_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}